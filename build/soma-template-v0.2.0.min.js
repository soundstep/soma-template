/*
soma-template - v0.2.0 - 2013-06-19
http://soundstep.github.com/soma-template/
http://www.soundstep.com
MIT licence 2013
*/
!function(a){"use strict";function b(a){return"[object Array]"===Object.prototype.toString.apply(a)}function c(a){return"object"==typeof a}function d(a){return"string"==typeof a}function e(a){return a?a.nodeType>0:!1}function f(a){return a&&a.nodeType&&3===a.nodeType}function g(a){return a&&"function"==typeof a}function h(a){return null!==a&&void 0!==a}function i(a){return h(a)?"true"===a||"1"===a||a===!0||1===a?!0:"false"===a||"0"===a||a===!1||0===a||d(a)&&H(a)?!1:!!a:!1}function j(a){return a&&g(a.toString)&&"[object Expression]"===a.toString()}function k(a){return d(a)?!!a.match(qb.func):!1}function l(a){return a&&a.parent&&yb.get(a.element)}function m(a){return a.replace(qb.escape,"\\$&")}function n(a,b){var c=ib.start().replace(/\\/g,""),d="",e=b?a:c;e.length>1&&(d="|\\"+e.substr(0,1)+"(?!\\"+e.substr(1,1)+")[^"+e.substr(0,1)+"]*"),qb.sequence=new RegExp(ib.start()+".+?"+ib.end()+"|[^"+ib.start()+"]+"+d,"g"),qb.token=new RegExp(ib.start()+".*?"+ib.end(),"g"),qb.expression=new RegExp(ib.start()+"|"+ib.end(),"gm")}function o(a){return a.replace(qb.trim,"")}function p(a){return qb.string.test(a)?a.substr(1,a.length-2):a}function q(a){return""===a[0]&&a.shift(),""===a[a.length-1]&&a.pop(),a}function r(a){return a.replace(qb.expression,"")}function s(a){return a.replace(qb.depth,"")}function t(a,b){a.parentNode&&a.parentNode.insertBefore(b,a)}function u(a,b){a.parentNode&&a.parentNode.insertBefore(b,a.nextSibling)}function v(a,b){var c;c=document.documentElement.classList?function(a,b){a.classList.remove(b)}:function(a,b){if(!a||!a.className)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"$2")},c(a,b)}function w(){function a(){return++d}function b(b){if(b){if("object"!=typeof b)return b;var c;try{c=b.hashkey?b.hashkey:b.hashkey=a()}catch(d){}return c}}var c={},d=1;this.remove=function(a){delete c[b(a)]},this.get=function(a){return c[b(a)]},this.put=function(a,d){c[b(a)]=d},this.has=function(a){return"undefined"!=typeof c[b(a)]},this.getData=function(){return c},this.dispose=function(){for(var a in c)c.hasOwnProperty(a)&&delete c[a];this.length=0}}function x(a,b){var c=a.match(qb.repeat);if(c){var d=c[2],e=new xb(d);return e.getValue(b)}}function y(a,b,c){var d=a.match(qb.repeat);if(d){var e=d[1];b[e]=c}}function z(a,b){var c=a.node||a.attribute.node,d=c.template.watchers,e=c.element;if(!d)return b;var i=d.get(e);!i&&f(c.element)&&c.parent&&(i=d.get(c.parent.element));var j=i?i:d.get(a.pattern);if(g(j)){var k=j(a.value,b,a.pattern,c.scope,c,a.attribute);if(h(k))return k}return b}function A(a,b){for(var c=F(b),d=a;c>0;)d=d._parent?d._parent:d,c--;return d}function B(a,b){var c=new xb(b);return C(a,c.pattern,c.path,c.params)}function C(a,b,c,d,e,f,i){if(console.log("--------------------------------------------------"),console.log("pattern",b),console.log("pathString",c),console.log("params",d),console.log("getFunction",e),console.log("getParams",f),console.log("paramsFound",i),qb.string.test(b))return p(b);var j=[];if(!i&&d)for(var k=0,l=d.length;l>k;k++)j.push(B(a,d[k]));else j=i;if(f)return j;var m=A(a,b);if(b=b.replace(/..\//g,""),c=c.replace(/..\//g,""),!m)return void 0;var n=m,o=c.split(/\.|\[|\]/g);if(o.length>0)for(var q=0,r=o.length;r>q;q++)if(""!==o[q]&&(n=n[o[q]]),!h(n))return m._parent?C(m._parent,b,c,d,e,f,j):void 0;return g(n)?e?n:n.apply(null,j):n}function D(a){var b=a.split("(")[0];return b=s(b)}function E(a){return q(a.split(qb.params))}function F(a){var b=a.split("(")[0],c=b.match(qb.depth);return c?c.length:0}function G(a,b,c){var d=new ub(a,b);d.previousSibling=a.previousSibling,d.nextSibling=a.nextSibling;for(var e,f,g,h=[],j=[],k=a.attributes,l=0,m=k&&k.length;m>l;l++)e=k[l],e.specified&&(f=e.name,g=e.value,f===hb.attributes.skip&&(d.skip=i(g)),f===hb.attributes.html&&(d.html=i(g)),f!==hb.attributes.repeat||c||(d.repeater=g),(H(f+":"+g)||f===hb.attributes.repeat||f===hb.attributes.skip||f===hb.attributes.html||f===hb.attributes.show||f===hb.attributes.hide||f===hb.attributes.href||f===hb.attributes.checked||f===hb.attributes.disabled||f===hb.attributes.multiple||f===hb.attributes.readonly||f===hb.attributes.selected||-1!==g.indexOf(hb.attributes.cloak))&&h.push(new vb(f,g,d)),lb[f]&&!c&&(j.push({name:lb[f],value:g}),h.push(new vb(f,g,d))));d.attributes=h;for(var n=0,o=j.length;o>n;n++)d.addEvent(j[n].name,j[n].value);return d}function H(a){var b=a.match(qb.token);return b&&b.length>0}function I(a){return qb.content.test(a)}function J(a){if(a){var b=a.nodeType;return a&&b?8===b?!1:3!==b||I(a.nodeValue)||H(a.nodeValue)?!0:!1:!1}}function K(a,b,c,d){if(J(b)){var e;if(d?(e=d,e.parent=c):e=G(b,c?c.scope:new tb(gb)._createChild(),c&&(c.repeater||c.isRepeaterDescendant)),c&&(c.repeater||c.isRepeaterDescendant)&&(e.isRepeaterDescendant=!0),e.template=a,!e.skip){for(var f=b.firstChild;f;){var g=K(a,f,e);g&&(g.parent=e,e.children.push(g)),f=f.nextSibling}return e}}}function L(a,b){M(a);for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function M(a){for(var b in a)a.hasOwnProperty(b)&&"_"!==b.substr(0,1)&&(a[b]=null,delete a[b])}function N(a){if(!a.repeater&&a.children&&!l(a))for(var b=0,c=a.children.length;c>b;b++)a.children[b].update()}function O(a){if(a.children&&!l(a))for(var b=0,c=a.children.length;c>b;b++)a.children[b].render()}function P(a){var c,d=x(a.repeater,a.scope);if(b(d)){for(var e=0,f=d.length,g=a.childrenRepeater.length,h=f>g?f:g;h>e;e++)f>e?c=R(a,e,d[e],kb.index,e,c):(a.parent.element.removeChild(a.childrenRepeater[e].element),a.childrenRepeater[e].dispose());a.childrenRepeater.length>d.length&&(a.childrenRepeater.length=d.length)}else{var i=-1;for(var j in d)d.hasOwnProperty(j)&&(i++,c=R(a,i,d[j],kb.key,j,c));for(var k=i;i++<a.childrenRepeater.length-1;)a.parent.element.removeChild(a.childrenRepeater[i].element),a.childrenRepeater[i].dispose();a.childrenRepeater.length=k+1}a.element.parentNode&&a.element.parentNode.removeChild(a.element)}function Q(a,b){var c=new ub(a,b.scope._createChild());if(b.attributes){for(var d=[],e=0,f=b.attributes.length;f>e;e++){if(c.renderAsHtml=b.renderAsHtml,b.attributes[e].name===hb.attributes.skip&&(c.skip=i(b.attributes[e].value)),b.attributes[e].name===hb.attributes.html&&(c.html=i(b.attributes[e].value)),b.attributes[e].name!==jb.repeat){var g=new vb(b.attributes[e].name,b.attributes[e].value,c);d.push(g)}lb[b.attributes[e].name]&&c.addEvent(lb[b.attributes[e].name],b.attributes[e].value)}c.attributes=d}return c}function R(a,b,c,d,e,f){var g=a.childrenRepeater[b];if(g)return y(a.repeater,g.scope,c),g.scope[d]=e,g.update(),g.render(),g.element;var h=a.element.cloneNode(!0),i=Q(h,a);return i.isRepeaterChild=!0,i.parent=a.parent,i.template=a.template,a.childrenRepeater[b]=i,y(a.repeater,i.scope,c),i.scope[d]=e,K(a.template,h,a.parent,i),i.update(),i.render(),f?u(f,h):a.previousSibling?u(a.previousSibling,h):a.nextSibling?t(a.nextSibling,h):a.parent.element.appendChild(h),h}function S(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else{c.$$guid||(c.$$guid=S.guid++),a.events||(a.events={});var d=a.events[b];d||(d=a.events[b]={},a["on"+b]&&(d[0]=a["on"+b])),d[c.$$guid]=c,a["on"+b]=function(a){var b=!0;a=a||U(((this.ownerDocument||this.document||this).parentWindow||window).event);var c=this.events[a.type];for(var d in c)c.hasOwnProperty(d)&&(this.$$handleEvent=c[d],this.$$handleEvent(a)===!1&&(b=!1));return b}}}function T(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.events&&a.events[b]&&delete a.events[b][c.$$guid]}function U(a){return a.preventDefault=U.preventDefault,a.stopPropagation=U.stopPropagation,a}function V(a,b,c){Ab=void 0===c?Number.MAX_VALUE:c,W(a,b,0,!0)}function W(a,b,c,d){if(!e(a))throw new Error("Error in soma.template.parseEvents, only a DOM Element can be parsed.");if(d&&X(a,b),0!==Ab)for(var f=a.firstChild;f;)1===f.nodeType&&Ab>c&&(W(f,b,++c),X(f,b)),f=f.nextSibling}function X(a,b){for(var c,d,e,f=a.attributes,h=0,i=f&&f.length;i>h;h++)if(c=f[h],c.specified&&(d=c.name,e=c.value,lb[d])){var j=Y(b,e);j&&g(j)&&(S(a,lb[d],j),Cb.push({element:a,type:lb[d],handler:j}))}}function Y(a,b){var c=b.match(qb.func);if(c){var d=c[1];if(g(a[d]))return a[d]}}function Z(a){for(var b=Cb.length,c=0;--b>=c;){var d=Cb[b];(a===d.element||sb(a,d.element))&&(T(d.element,d.type,d.handler),Cb.splice(b,1))}}function $(a,b,c){var d=_(b);c(d,d.scope,d.element,d.node)}function _(b,c){var f;if(d(b)){if(!e(c))throw new Error(a.template.errors.TEMPLATE_STRING_NO_ELEMENT);c.innerHTML=b,f=c}else{if(!e(b))throw new Error(a.template.errors.TEMPLATE_NO_PARAM);e(c)?(c.innerHTML=b.innerHTML,f=c):f=b}ab(f)&&(ab(f).dispose(),yb.remove(f));var g=new zb(f);return yb.put(f,g),g}function ab(a){return yb.get(a)}function bb(){var a=yb.getData();for(var b in yb.getData())a.hasOwnProperty(b)&&yb.get(b).render()}function cb(a){if(null===a&&(fb={},gb={}),h(a)&&c(a))for(var b in a)a.hasOwnProperty(b)&&(fb[b]=gb[b]=a[b]);return fb}a.template=a.template||{},a.template.version="0.2.0",a.template.errors={TEMPLATE_STRING_NO_ELEMENT:"Error in soma.template, a string template requirement a second parameter: an element target - soma.template.create('string', element)",TEMPLATE_NO_PARAM:"Error in soma.template, a template requires at least 1 parameter - soma.template.create(element)"};var db="{{",eb="}}",fb={},gb={},hb=a.template.settings=a.template.settings||{};hb.autocreate=!0;var ib=hb.tokens={start:function(a){return h(a)&&""!==a&&(db=m(a),n(a,!0)),db},end:function(a){return h(a)&&""!==a&&(eb=m(a),n(a,!1)),eb}},jb=hb.attributes={skip:"data-skip",repeat:"data-repeat",src:"data-src",href:"data-href",show:"data-show",hide:"data-hide",cloak:"data-cloak",checked:"data-checked",disabled:"data-disabled",multiple:"data-multiple",readonly:"data-readonly",selected:"data-selected",template:"data-template",html:"data-html"},kb=hb.vars={index:"$index",key:"$key"},lb=hb.events={};hb.eventsPrefix="data-";var mb="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup focus blur change select selectstart scroll copy cut paste mousewheel keypress error contextmenu input textinput drag dragenter dragleave dragover dragend dragstart dragover drop load submit reset search resize beforepaste beforecut beforecopy";mb+=" touchstart touchend touchmove touchenter touchleave touchcancel gesturestart gesturechange gestureend";for(var nb=mb.split(" "),ob=-1,pb=nb.length;++ob<pb;)lb[hb.eventsPrefix+nb[ob]]=nb[ob];var qb={sequence:null,token:null,expression:null,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,trim:/^[\s+]+|[\s+]+$/g,repeat:/(.*)\s+in\s+(.*)/,func:/(.*?)\((.*)\)/,params:/,\s+|,|\s+,\s+/,quote:/\"|\'/g,content:/[^.|^\s]/gm,depth:/..\//g,string:/^(\"|\')(.*)(\"|\')$/},rb=function(){if("object"!=typeof document)return void 0;for(var a=3,b=!1,c=document.createElement("div");!b;)c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c.getElementsByTagName("i")[0]||(b=!0);return a>4?a:void 0}(),sb="object"!=typeof document?function(){}:document.documentElement.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&1===d.nodeType&&c.contains&&c.contains(d))}:document.documentElement.compareDocumentPosition?function(a,b){return b&&!!(16&a.compareDocumentPosition(b))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},tb=function(a){function b(a){var b=c(a);return b._parent=d,d._children.push(b),b}function c(a){var c=a||{};return c._parent=null,c._children=[],c._createChild=function(){return d=c,b.apply(c,arguments)},c}var d;return c(a)},ub=function(a,b){this.element=a,this.scope=b,this.attributes=null,this.value=null,this.interpolation=null,this.invalidate=!1,this.skip=!1,this.repeater=null,this.isRepeaterDescendant=!1,this.isRepeaterChild=!1,this.parent=null,this.children=[],this.childrenRepeater=[],this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers={},this.html=!1,f(this.element)&&(this.value=this.element.nodeValue,this.interpolation=new wb(this.value,this,void 0))};ub.prototype={toString:function(){return"[object Node]"},dispose:function(){this.clearEvents();var a,b;if(this.children)for(a=0,b=this.children.length;b>a;a++)this.children[a].dispose();if(this.childrenRepeater)for(a=0,b=this.childrenRepeater.length;b>a;a++)this.childrenRepeater[a].dispose();if(this.attributes)for(a=0,b=this.attributes.length;b>a;a++)this.attributes[a].dispose();this.interpolation&&this.interpolation.dispose(),this.element=null,this.scope=null,this.attributes=null,this.attributesHashMap=null,this.value=null,this.interpolation=null,this.repeater=null,this.parent=null,this.children=null,this.childrenRepeater=null,this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers=null},getNode:function(a){var b;if(a===this.element)return this;if(this.childrenRepeater.length>0){for(var c=0,d=this.childrenRepeater.length;d>c;c++)if(b=this.childrenRepeater[c].getNode(a))return b}else for(var e=0,f=this.children.length;f>e;e++)if(b=this.children[e].getNode(a))return b;return null},getAttribute:function(a){if(this.attributes)for(var b=0,c=this.attributes.length;c>b;b++){var d=this.attributes[b];if(d.interpolationName&&d.interpolationName.value===a)return d}},update:function(){if(!l(this)){if(h(this.interpolation)&&this.interpolation.update(),h(this.attributes))for(var a=0,b=this.attributes.length;b>a;a++)this.attributes[a].update();N(this)}},invalidateData:function(){if(!l(this)){this.invalidate=!0;var a,b;if(this.attributes)for(a=0,b=this.attributes.length;b>a;a++)this.attributes[a].invalidate=!0;for(a=0,b=this.childrenRepeater.length;b>a;a++)this.childrenRepeater[a].invalidateData();for(a=0,b=this.children.length;b>a;a++)this.children[a].invalidateData()}},addEvent:function(a,b){if(!this.repeater){this.eventHandlers[a]&&this.removeEvent(a);var c=this.scope,d=function(a){var d=new xb(b,this.node),e=d.getValue(c,!0),f=d.getValue(c,!1,!0);f.unshift(a),e&&e.apply(null,f)};this.eventHandlers[a]=d,S(this.element,a,d)}},removeEvent:function(a){T(this.element,a,this.eventHandlers[a]),this.eventHandlers[a]=null,delete this.eventHandlers[a]},clearEvents:function(){if(this.eventHandlers)for(var a in this.eventHandlers)this.eventHandlers.hasOwnProperty(a)&&this.removeEvent(a);if(this.children)for(var b=0,c=this.children.length;c>b;b++)this.children[b].clearEvents();if(this.childrenRepeater)for(var d=0,e=this.childrenRepeater.length;e>d;d++)this.childrenRepeater[d].clearEvents()},render:function(){if(!l(this)){if(this.invalidate&&(this.invalidate=!1,f(this.element)&&(this.value=this.parent&&this.parent.html?this.parent.element.innerHTML=this.interpolation.render():this.element.nodeValue=this.interpolation.render())),this.attributes)for(var a=0,b=this.attributes.length;b>a;a++)this.attributes[a].render();this.repeater?P(this):O(this)}}};var vb=function(a,b,c){this.name=a,this.value=b,this.node=c,this.interpolationName=new wb(this.name,null,this),this.interpolationValue=new wb(this.value,null,this),this.invalidate=!1};vb.prototype={toString:function(){return"[object Attribute]"},dispose:function(){this.interpolationName&&this.interpolationName.dispose(),this.interpolationValue&&this.interpolationValue.dispose(),this.interpolationName=null,this.interpolationValue=null,this.node=null,this.name=null,this.value=null,this.previousName=null},update:function(){this.interpolationName.update(),this.interpolationValue.update()},render:function(){function a(a,b){7===rb&&"class"===a?e.className=b:e.setAttribute(a,b)}function b(a,b){i(a)?e.setAttribute(b,b):e.removeAttribute(b)}function c(a){e.setAttribute("src",a)}function d(a){e.setAttribute("href",a)}if(!this.node.repeater){var e=this.node.element;if(this.invalidate&&(this.invalidate=!1,this.previousName=this.name,this.name=h(this.interpolationName.render())?this.interpolationName.render():this.name,this.value=h(this.interpolationValue.render())?this.interpolationValue.render():this.value,this.name===jb.src?c(this.value):this.name===jb.href?d(this.value):((7!==rb||7===rb&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.interpolationName.value),this.previousName&&(7===rb&&"class"===this.previousName?this.node.element.className="":(7!==rb||7===rb&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.previousName)),a(this.name,this.value,this.previousName))),"class"===this.name&&-1!==this.value.indexOf(hb.attributes.cloak)&&v(this.node.element,hb.attributes.cloak),this.name===jb.hide){var f=i(this.value);a(this.name,f),e.style.display=f?"none":""}if(this.name===jb.show){var f=i(this.value);a(this.name,f),e.style.display=f?"":"none"}if(this.name===jb.checked&&(b(this.value,"checked"),a(this.name,i(this.value)?!0:!1)),this.name===jb.disabled&&(b(this.value,"disabled"),a(this.name,i(this.value)?!0:!1)),this.name===jb.multiple&&(b(this.value,"multiple"),a(this.name,i(this.value)?!0:!1)),this.name===jb.readonly){var f=i(this.value);7===rb?e.readOnly=f?!0:!1:b(this.value,"readonly"),a(this.name,f?!0:!1)}this.name===jb.selected&&(b(this.value,"selected"),a(this.name,i(this.value)?!0:!1))}}};var wb=function(a,b,c){this.value=b&&!f(b.element)?o(a):a,this.node=b,this.attribute=c,this.sequence=[],this.expressions=[];var d=this.value.match(qb.sequence);if(d){for(var e=0,g=d.length;g>e;e++)if(d[e].match(qb.token)){var h=new xb(r(d[e]),this.node,this.attribute);this.sequence.push(h),this.expressions.push(h)}else this.sequence.push(d[e]);q(this.sequence)}};wb.prototype={toString:function(){return"[object Interpolation]"},dispose:function(){if(this.expressions)for(var a=0,b=this.expressions.length;b>a;a++)this.expressions[a].dispose();this.value=null,this.node=null,this.attribute=null,this.sequence=null,this.expressions=null},update:function(){for(var a=-1,b=this.expressions.length;++a<b;)this.expressions[a].update()},render:function(){var a="";if(this.sequence)for(var b=0,c=this.sequence.length;c>b;b++){var d="";d=j(this.sequence[b])?this.sequence[b].value:this.sequence[b],h(d)||(d=""),a+=d}return a}};var xb=function(a,b,c){h(a)&&(this.pattern=a,this.isString=qb.string.test(a),this.node=b,this.attribute=c,this.value=this.isString?this.pattern:void 0,this.isString?(this.isFunction=!1,this.depth=null,this.path=null,this.params=null):(this.isFunction=k(this.pattern),this.depth=F(this.pattern),this.path=D(this.pattern),this.params=this.isFunction?E(this.pattern.match(qb.func)[2]):null))};xb.prototype={toString:function(){return"[object Expression]"},dispose:function(){this.pattern=null,this.node=null,this.attribute=null,this.path=null,this.params=null,this.value=null},update:function(){var a=this.node;if(!a&&this.attribute&&(a=this.attribute.node),a||!a.scope){var b=this.getValue(a.scope);b=z(this,b),this.value!==b&&(this.value=b,(this.node||this.attribute).invalidate=!0)}},getValue:function(a,b,c){return C(a,this.pattern,this.path,this.params,b,c)}};var yb=new w,zb=function(a){this.watchers=new w,this.node=null,this.scope=null,this.compile(a)};zb.prototype={toString:function(){return"[object Template]"},compile:function(a){a&&(this.element=a),this.node&&this.node.dispose(),this.node=K(this,this.element),this.node.root=!0,this.scope=this.node.scope},update:function(a){h(a)&&L(this.node.scope,a),this.node&&this.node.update()},render:function(a){this.update(a),this.node&&this.node.render()},invalidate:function(){this.node&&this.node.invalidateData()},watch:function(a,b){(d(a)||e(a))&&g(b)&&this.watchers.put(a,b)},unwatch:function(a){this.watchers.remove(a)},clearWatchers:function(){this.watchers.dispose()},clearEvents:function(){this.node.clearEvents()},getNode:function(a){return this.node.getNode(a)},dispose:function(){yb.remove(this.element),this.watchers&&this.watchers.dispose(),this.node&&this.node.dispose(),this.element=null,this.watchers=null,this.node=null}},S.guid=1,U.preventDefault=function(){this.returnValue=!1},U.stopPropagation=function(){this.cancelBubble=!0};var Ab,Bb,Cb=[];if("object"==typeof document){var Bb=function(){function a(a){for(l=1;a=c.shift();)a()}var b,c=[],d=!1,e=document,f=e.documentElement,g=f.doScroll,h="DOMContentLoaded",i="addEventListener",j="onreadystatechange",k="readyState",l=/^loade|c/.test(e[k]);return e[i]&&e[i](h,b=function(){e.removeEventListener(h,b,d),a()},d),g&&e.attachEvent(j,b=function(){/^c/.test(e[k])&&(e.detachEvent(j,b),a())}),g?function(a){self!=top?l?a():c.push(a):function(){try{f.doScroll("left")}catch(b){return setTimeout(function(){Bb(a)},50)}a()}()}:function(a){l?a():c.push(a)}}();if(hb.autocreate){var Db=function(b){for(var c=b?b.firstChild:document.body;c;){if(1===c.nodeType){Db(c);var d=c.getAttribute(jb.template);if(d){var e=new Function("return "+d+";");try{var f=e();g(f)&&a.template.bootstrap(d,c,f)}catch(h){}}}c=c.nextSibling}};Bb(Db)}}ib.start(db),ib.end(eb),a.plugins=a.plugins||{};var Eb=function(instance,injector){instance.constructor.prototype.createTemplate=function(b,c){if(!b||"function"!=typeof b)throw new Error("Error creating a template, the first parameter must be a function.");if(c&&e(c)){var d=a.template.create(c);for(var f in d)"function"==typeof d[f]&&(b.prototype[f]=d[f].bind(d));b.prototype.render=d.render.bind(d);var g=injector.createChild();return g.mapValue("template",d),g.mapValue("scope",d.scope),g.mapValue("element",d.element),g.createInstance(b)}return null},a.template.bootstrap=function(a,b,c){instance.createTemplate(c,b)}};a.plugins&&a.plugins.add&&a.plugins.add(Eb),a.template.Plugin=Eb,a.template.create=_,a.template.get=ab,a.template.renderAll=bb,a.template.helpers=cb,a.template.bootstrap=$,a.template.addEvent=S,a.template.removeEvent=T,a.template.parseEvents=V,a.template.clearEvents=Z,a.template.ready=Bb,"function"==typeof define&&"undefined"!=typeof define.amd&&define("soma-template",a.template),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=a.template),"undefined"!=typeof exports&&(exports=a.template)}(this.soma=this.soma||{});